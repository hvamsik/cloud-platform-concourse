# cloud-platform-concourse

Concourse CI for the Cloud Platform

## Install / Upgrade
In order to setup concourse initially on a cluster, you will need to have `terraform`, `kubectl` and `helm` installed.

1. Edit `resources/secrets.tf` and add a configuration block for the new cluster, if one does not already exist.

2. Create `concourse` namespace and setup RBAC for `tiller` (see example [here](https://github.com/ministryofjustice/cloud-platform-environments/blob/master/namespaces/cloud-platform-live-0.k8s.integration.dsd.io/concourse/rbac-config-tiller.yaml))

3. `./setup <cluster-name>` where `cluster-name` is the name of the cluster you want to install Concourse CI on, as it appears in the terraform workspaces [here](https://github.com/ministryofjustice/kubernetes-investigations/tree/master/terraform/cloud-platform).

## Removing
Currently a manual task:
1. Remove `helm` deployment:
```sh
helm --kube-context=<context> --tiller-namespace concourse delete --purge concourse
```
2. Cleanup namespaces generated by concourse for storing team secrets (`concourse-<team-name>`)
3. Destroy terraform managed resources:
```sh
cd resources
terraform select workspace <cluster-name>
terraform destroy
terraform select workspace default
terraform workspace delete <cluster-name>
```

## Pipelines
Pipeline configuration can be managed in this repository, please read the documentation [here](pipelines/README.md).
